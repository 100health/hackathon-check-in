<!DOCTYPE html>
<!--[if lte IE 6]><html class="preIE7 preIE8 preIE9"><![endif]-->
<!--[if IE 7]><html class="preIE8 preIE9"><![endif]-->
<!--[if IE 8]><html class="preIE9"><![endif]-->
<!--[if gte IE 9]><!--><html><!--<![endif]-->
  <head>
    <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redox Check-In Demo</title>
  <meta name="author" content="name">
  <meta name="description" content="description here">
  <meta name="keywords" content="keywords,here">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript"></script>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular.min.js" type="text/javascript"></script>

  <style type="text/css">
    .fix{
      position:fixed;
      bottom:0px;
      left:5%;
      max-height: 150px;
    }
  </style>

  <script>
    var app = angular.module('myApp', []);
    app.controller('myCtrl', function($scope, $http, $timeout) {
      $scope.error = "";
      $scope.success = "";

      $http.get('/api/scheduling').then(function success(response) {
        $scope.scheduling = response.data;
      }, function error(response) {
        $scope.error = response.data;
        $timeout(function () {
          $scope.error = "";
        }, 10000);
      }); 

      $scope.sendUpdate = function () {
        var update = {
          Patient: {
            Identifiers: $scope.scheduling.Patient.Identifiers
          },
          Visit: {
            VisitNumber: $scope.scheduling.Visit.VisitNumber,
            PatientClass: $scope.scheduling.Visit.PatientClass,
            Reason: $scope.reason,
            Instructions: [$scope.instructions]
          }
        };
        $http.post('/api/visitupdate', update).then(function success(response) {
          $scope.success = "VisitUpdate successfully sent!";
          $timeout(function () {
            $scope.success = "";
          }, 10000);
        });
      }      
    });
  </script>

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  </head>
  <body>
    <div ng-app="myApp" ng-controller="myCtrl" class="container">
      <h1>Czech Inn Fun!</h1>

      <!-- Success Messages (if any) -->
      <div class="alert alert-success" role="alert" ng-if="success != ''">{{ success }}</div>
      <!-- Error Messages (if any) -->
      <div class="alert alert-danger" role="alert" ng-if="error != ''">{{ error }}</div>

      <div ng-if="scheduling">
        <!-- Scheduling.New (most recent) Info from Redox GET /api/scheduling --> 
        <h2>{{ scheduling.Patient.Demographics.LastName }}, {{ scheduling.Patient.Demographics.FirstName }} <small>{{ scheduling.Patient.Demographics.DOB }}</small></h2>

        <!-- Fake email sent to patient, button to check in VisitID from scheduling -->
        <form ng-submit="sendUpdate()">
          <div class="form-group">
            <label for="visitreason">Visit Reason</label>
            <input type="test" class="form-control" id="visitreason" placeholder="Tell me where it hurts???">
          </div>
          <div class="form-group">
            <label for="visitinstructions">Special Instructions</label>
            <input type="test" class="form-control" id="visitinstructions" placeholder="Please warm the towel.">
          </div>
          <button type="submit" class="btn btn-default">Submit</button>
        </form>
      </div>
    </div>
    <img src="https://www.clipartmasters.com/clip-arts/697/log-house-clip-art-697288.png" class="fix"/>
  </body>
</html>